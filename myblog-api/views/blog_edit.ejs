<%- include('header') %>

<div class="ui grid">
    <div class="four wide column">
        <a class="avatar"
           href="/blog?author=<%= user._id %>"
           data-title="<%= user.name %> | <%= ({m: '男', f: '女', x: '保密'})[user.gender] %>"
           data-content="<%= user.bio %>">
            <img class="avatar" src="/img/<%= user.avatar %>">
        </a>
    </div>

    <div class="eight wide column">
        <form class="ui form segment" method="post" action="/blog/<%= blog._id %>/edit">
            <div class="field required">
                <label>标题</label>
                <input type="text" name="title" value="<%= blog.title %>">
            </div>
            <div class="field required">
                <label>内容</label>
                <textarea name="content" rows="15"><%= blog.content %></textarea>
            </div>
            <input type="submit" class="ui button" value="发布">
        </form>
    </div>
</div>

<%- include('footer') %>
<script>
    $(function () {
        $("#submit").on('click', function () {
            var title = $('#title').val()
            var content = $('#content').val()
            if (title && content) {
                $.ajax({
                    url: 'http://localhost:3000/blog/edit',
                    type: 'post',
                    data: {title: title, content: content},
                    success: function (r) {
                        console.log(3, r)
                        if (r.status == 200) {
                            location.href = '/blog'
                        }else{
                            //用户名或密码错误
                            alert(r.message)
                        }
                    }
                })
            } else {
                alert('标题或内容不能为空')
            }
        })
    })
</script>
